<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FGO Card Generator</title>
	<style type="text/css">
		body{
			background: linear-gradient(-45deg, #F2F2F2 25%, #F5F5F5 0, #F5F5F5 50%, #F2F2F2 0, #F2F2F2 75%, #F5F5F5 0);
			background-size: 100px 100px;
		}
		#main-container
		{
			background: linear-gradient(45deg, #F2F2F2 25%, #F5F5F5 0, #F5F5F5 50%, #F2F2F2 0, #F2F2F2 75%, #F5F5F5 0);
			background-size: 100px 100px;
			border: 1px solid #E0E0E0;
			position: relative;
			padding-top: 10px;
			padding-bottom: 10px;
			width: 100%;
			max-width: 500px;
			text-align: center;
			margin: 0 auto;
		}
		#Canvas-container
		{
			position: relative;
			max-width: 500px;
			width: 100%;
			margin: 0 auto;
		}
		@font-face {
			font-family: FGO;
			src: url('Font/CasadSerial-Medium.ttf') format("truetype");	
		}
	</style>
	<script type="text/javascript">
		function preLoadImg(url) //图片预下载用的函数
		{ 
			var img = new Image(); 
			img.src = url;
		} 
		function imgPreview(fileDom)//上传图片用的函数
		{
        	//判断是否支持FileReader
    	if (window.FileReader) {
    		var reader = new FileReader();
    	} else {
    		alert("Your device doesn't support uploading images.");
    	}
    	//获取文件
    	var file = fileDom.files[0];
    	var imageType = /^image\//;
    	//是否是图片
    	if (!imageType.test(file.type)) 
    	{
    		alert("Please upload a picture!");
    		return;
    	}	
      //读取完成
      reader.onload = function(e) 
      {
          //获取图片dom
          var img = document.getElementById("preview");
          //图片路径设置为读取的图片
          img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    function get_pic(id)//画出图鉴的函数
    {
    	var canvas=document.getElementById(id);
    	var content=canvas.getContext("2d");
    	var img_logo=new Image();
    	var img_frame=new Image();
    	var img_hero=new Image();
    	img_logo.crossOrigin = '';
    	img_hero.crossOrigin = '';
    	var Hero_class=document.getElementById("Hero_class").value || "all";
    	var Hero_rarity=document.getElementById("Hero_rarity").value || 5;
    	var Hero_name=document.getElementById("Hero_name").value || "Unknown";
    	var ATK=document.getElementById("ATK").value || 0;
    	var HP=document.getElementById("HP").value || 0;
    	var img_hero=document.getElementById("preview");
    	if(!Hero_name) 
    	{
    		alert("Name is not defined");return;
    	}
    	if(!img_hero.src) 
    	{
    		alert("Please upload a picture!");return;
    	}
    	if (Hero_rarity == 1 || Hero_rarity == 2) {
    		img_logo.src="img/fgo/" + Hero_class + "1.png";
    	} else if (Hero_rarity == 3) {
    		img_logo.src="img/fgo/" + Hero_class + "2.png";
    	} else {
    		img_logo.src="img/fgo/" + Hero_class + "3.png";
    	}
    	img_frame.src = "img/fgo/S" + Hero_rarity + ".png";
    	preLoadImg(img_frame.src);
    	preLoadImg(img_hero.src);
    	img_frame.onload = function()
    	{
    		content.drawImage(img_hero,0,0,500,730);
        content.drawImage(img_frame,0,0,500,850);
        switch (Hero_class) {
          case "saber":
            content.drawImage(img_logo,213,753,76,76);
            break;
          case "archer":
            content.drawImage(img_logo,211,753,76,76);
            break;
          case "lancer":
            content.drawImage(img_logo,213,753,76,76);
            break;
          case "caster":
            content.drawImage(img_logo,215,753,76,76);
            break;
          case "assassin":
            content.drawImage(img_logo,213,751,76,76);
            break;
          case "rider":
            content.drawImage(img_logo,215,754,76,76);
            break;
          case "berserker":
            content.drawImage(img_logo,213,751,76,76);
            break;
          case "ruler":
            content.drawImage(img_logo,213,753,76,76);
            break;
          case "shielder":
            content.drawImage(img_logo,213,750,76,76);
            break;
          case "avenger":
            content.drawImage(img_logo,213,752,76,76);
            break;
        }
    		/*职介部分*/
				content.textAlign="center";//是文字居中
				content.font="50px FGO";
				content.lineWidth = 4;//描边的宽度
				content.strokeStyle = "black";//描边的颜色
				content.strokeText(Hero_class,250,727);
				content.fillStyle="white";//内部颜色
				content.fillText(Hero_class,250,727);
				/*短横线*/
				content.strokeStyle="white";
				content.moveTo(100,732);
				content.lineTo(400,732);
				content.lineWidth = 2;
				content.stroke();
				/*英灵名称*/
				content.font="22px 隶书";
				content.strokeStyle = "black";
				content.lineWidth = 3;//描边的宽度
				content.strokeText(Hero_name,250,753);
				content.fillStyle="white";
				content.fillText(Hero_name,250,753);
				/*ATK*/
				content.font="50px FGO";
				content.strokeStyle = "black";
				content.strokeText(ATK,130,830);
				content.fillStyle="white";
				content.fillText(ATK,130,830);
				/*HP*/
				content.strokeStyle = "black";
				content.strokeText(HP,370,830);
				content.fillStyle="white";
				content.fillText(HP,370,830);
				//画布内有图片存在，故不能直接使用toDataURL()，需考虑CROS
				dataURL=canvas.toDataURL();
				document.getElementById('pic_show').src = dataURL;
			}
			// canvas.hidden=null;
			resize();
		}
		function resize(){
			width=document.body.clientWidth;
			if(width<=500)
			{
				document.getElementById("pic_show").style.width="100%";
			}
			else{
				document.getElementById("pic_show").style.width="500px";
			}
		}
	</script>
</head>
<body onresize="resize()">
	<div id="main-container" >
		<div style="font-size: 35px; text-align: center; color: green">FGO Card Generator</div>	
    <div style="text-align: center; font-size: 15px; padding-bottom: 20px">Original Code by juncaixinchi<br>Expanded by Aister</div>
		Name<br><br>
		<input type="text" id="Hero_name" placeholder="Name" style="max-width:250px; width: 100%"><br><br>
		Rarity<br><br>
		<select id="Hero_rarity" style="max-width:250px; width: 100%">
		  <option value="1">1 ☆</option>
		  <option value="2">2 ☆</option>
		  <option value="3">3 ☆</option>
		  <option value="4">4 ☆</option>
		  <option value="5">5 ☆</option>
		</select><br><br>
		Class<br><br>
		<select id="Hero_class" style="max-width:250px; width: 100%">
			<option value="saber">Saber</option>
			<option value="lancer">Lancer</option>
			<option value="archer">Archer</option>
			<option value="rider">Rider</option>
			<option value="caster">Caster</option>
			<option value="assassin">Assassin</option>
			<option value="berserker">Berserker</option>
			<option value="ruler">Ruler</option>
			<option value="avenger">Avenger</option>
			<option value="shielder">Shielder</option>
			<option value="all">Misc</option>
		</select><br><br>
		<div style="text-align: left; display:inline-block; width:50px">ATK：</div><input type="number" id="ATK">
		<br>
		<br>
		<div style="text-align: left; display:inline-block; width:50px">HP：</div><input type="number" id="HP">
		<br>
		<br>
		Please upload the photo<br><br>
		<input type="file" name="file" onchange="imgPreview(this)" value="上传图片">
		<br>
		<br>
		<a href="#Canvas-position"><button onclick="get_pic('myCanvas')">Generate!</button></a>
		<br>
		<p style="font-size: 10pt">Tips: For best result, please use image size of 730 x 500！</p>
		<!--两个例子：
 		<a href="#Canvas-position"><button onclick="get_zhou()">生成周天王！</button></a>
 		<a href="#Canvas-position"><button onclick="get_lei()">生成蕾姆！</button></a> -->
 		<img id="preview" hidden="hidden">
 	</div>
 	<div id="Canvas-container">
 		<a name="Canvas-position">
 			<canvas id="myCanvas" width="500" height="850" style="border:1px solid #c3c3c3" hidden="hidden">
 				Your browser doesn't support Canvas, please use a more modern browser!
 			</canvas>
 			<img id="pic_show">
 		</a>
 	</div>
 </body>
 </html>
